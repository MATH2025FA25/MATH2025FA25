{
  "hash": "38dded8f0aff2de3b4922c9df6290573",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"SLR: Outliers\"\nauthor: \"Prof. Eric Friedlander\"\ndate: \"2024-09-25\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[ðŸ”— MAT 212 - Fall 2024 -  Schedule](https://mat212fa24.netlify.app/schedule)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    multiplex: false\n    transition: fade\n    slide-number: false\n    incremental: false \n    chalkboard: true\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\nexecute:\n  freeze: auto\n  echo: true\n  cache: true\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\nbibliography: references.bib\n---\n\n\n\n\n\n\n\n\n# Double Application Exercise\n\n::: appex\nðŸ“‹ [AE-07: Evaluating Models](https://mat212fa24.netlify.app/ae/ae-07-model-eval)\n:::\n\n::: appex\nðŸ“‹ [AE-08: Transformations](https://mat212fa24.netlify.app/ae/ae-08-transformations)\n:::\n\n\n\n## Computational set up\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# load packages\nlibrary(tidyverse)   # for data wrangling and visualization\nlibrary(broom)       # for formatting model output\nlibrary(ggformula)   # for creating plots using formulas\nlibrary(scales)      # for pretty axis labels\nlibrary(knitr)       # for pretty tables\nlibrary(moderndive)  # for house_price dataset\nlibrary(fivethirtyeight) # for fandango dataset\nlibrary(kableExtra)  # also for pretty tables\nlibrary(patchwork)   # arrange plots\n\n# set default theme and larger font size for ggplot2\nggplot2::theme_set(ggplot2::theme_bw(base_size = 20))\n```\n:::\n\n\n\n\n\n# Outliers\n\n## Types of \"Unusual\" Points in SLR\n\n- **Outlier**: a data point that is far from the regression line\n- **Influential point**: a data point that has a large effect on the regression fit\n\n. . .\n\n:::{.question}\n- How do we measure \"far\"?\n- How do we measure \"effect on the fit\"?\n:::\n\n## Detecting Unusual Cases: Overview\n\n1. Compute residuals\n    + \"raw\", standardized, studentized\n2. Plots of residuals\n    + boxplot, scatterplot, normal plot\n3. Leverage\n    + unusual values for the predictors\n  \n## Example: Movie scores\n\n::: columns\n::: {.column width=\"70%\"}\n-   Data behind the FiveThirtyEight story [*Be Suspicious Of Online Movie Ratings*](https://fivethirtyeight.com/features/fandango-movies-ratings/)[*, Especially Fandango's*](%22Be%20Suspicious%20Of%20Online%20Movie%20Ratings,%20Especially%20Fandango's%22)\n-   In the **fivethirtyeight** package: [`fandango`](https://fivethirtyeight-r.netlify.app/reference/fandango.html)\n-   Contains every film released in 2014 and 2015 that has at least 30 fan reviews on Fandango, an IMDb score, Rotten Tomatoes critic and user ratings, and Metacritic critic and user scores\n:::\n\n::: {.column width=\"30%\"}\n![](images/02/fandango.png){fig-alt=\"Fandango logo\" width=\"200\"}\n\n![](images/02/imdb.png){fig-alt=\"IMDB logo\" width=\"200\"}\n\n![](images/02/rotten-tomatoes.png){fig-alt=\"Rotten Tomatoes logo\" width=\"200\"}\n\n![](images/02/metacritic.png){fig-alt=\"Metacritic logo\" width=\"200\"}\n:::\n:::\n\n## Data prep\n\n-   Rename Rotten Tomatoes columns as `critics` and `audience`\n-   Rename the dataset as `movie_scores`\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmovie_scores <- fandango |>\n  rename(critics = rottentomatoes, \n         audience = rottentomatoes_user)\n```\n:::\n\n\n\n\n\n## Example: Movie Scores\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nmovie_scores |> \n  gf_point(audience ~ critics) |> \n  gf_lm() |> \n  gf_labs(x = \"Critics Score\", \n       y = \"Audience Score\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using the `size` aesthetic with geom_line was deprecated in ggplot2 3.4.0.\nâ„¹ Please use the `linewidth` aesthetic instead.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](13-slr-outliers_files/figure-html/unnamed-chunk-1-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n\n## Boxplot of Residuals\n\n:::{.smaller}\n\n\n\n\n::: {.cell layout-align=\"center\" output-location='column'}\n\n```{.r .cell-code}\nmovie_fit <- lm(audience ~ critics, data = movie_scores)\nmovie_fit_aug <- augment(movie_fit)\n\ngf_boxplot(.resid ~ \"\", data = movie_fit_aug, \n           fill = \"salmon\", ylab = \"Residuals\", xlab = \"\")\n```\n\n::: {.cell-output-display}\n![](13-slr-outliers_files/figure-html/unnamed-chunk-2-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n:::\n\n- Dots (outliers) indicate data points more than 1.5 IQRs above (or below) quartiles\n\n## Standardized Residuals\n\n:::{.incremental}\n- Recall: Z-scores\n- Fact: If $X$ has mean $\\mu$ and standard deviation $\\sigma$, then $(X-\\mu)/\\sigma$ has mean 0 and standard deviation 1\n- For residuals: mean 0 and standard deviation $\\hat{\\sigma}_\\epsilon$\n- **Standardized residuals:** $\\frac{y_i-\\hat{y}_i}{\\hat{\\sigma}_\\epsilon}$\n  + Look for values beyond $\\pm 2$ or $\\pm 3$\n:::\n\n## Recap: `Augment` function\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmovie_fit_aug |> \n  head() |> \n  kable()\n```\n\n::: {.cell-output-display}\n\n\n| audience| critics|  .fitted|     .resid|      .hat|   .sigma|   .cooksd| .std.resid|\n|--------:|-------:|--------:|----------:|---------:|--------:|---------:|----------:|\n|       86|      74| 70.69768|  15.302321| 0.0081597| 12.51615| 0.0061774|  1.2254688|\n|       80|      85| 76.40313|   3.596866| 0.0112688| 12.57830| 0.0004743|  0.2885034|\n|       90|      80| 73.80975|  16.190255| 0.0096283| 12.50817| 0.0081839|  1.2975389|\n|       84|      18| 41.65173|  42.348272| 0.0207618| 12.06226| 0.1234982|  3.4131653|\n|       28|      14| 39.57702| -11.577018| 0.0234805| 12.54373| 0.0104964| -0.9343768|\n|       62|      63| 64.99222|  -2.992225| 0.0068844| 12.57943| 0.0001988| -0.2394750|\n\n\n:::\n:::\n\n\n\n\n\n## Example: Movie Scores\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\np1 <- movie_fit_aug |>  # Augmented data\n  gf_boxplot(\"\" ~ .std.resid, \n           xlab = \"Standardized Residual\")\n\np2 <- movie_fit_aug |>  # Augmented data\n  gf_point(.std.resid ~ .fitted, \n           xlab = \"Predicted\", ylab = \"Standardized Residual\")\n\np1 + p2\n```\n\n::: {.cell-output-display}\n![](13-slr-outliers_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n\n## (Externally) Studentized Residuals\n\n- Concern: An unusual value may exert great influence on the fit\n  + Its residual might be underestimated because the model \"moves\" a lot to fit it\n  + The standard error may also be inflated due to the outlier error\n- **Studentize:** Fit the model *without* that case, then find new $\\hat{\\sigma}_\\epsilon$\n\n## Example: Movie Scores\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmovie_fit_aug |>  # Augmented data\n  mutate(studentized_residual = rstudent(movie_fit)) |> \n  gf_point(studentized_residual ~ .fitted, \n           xlab = \"Predicted\", ylab = \"Studentized Residual\")\n```\n\n::: {.cell-output-display}\n![](13-slr-outliers_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n\n## What to do with an outlier?\n\n- Look into it\n- If something is unusual about it and you can make a case that it is not a good representation of the population you can throw it out\n- If not and the value is just unusual, keep it\n\n## Influence vs. Leverage\n\n- **High Influence Point**: point that DOES impact the regression line\n- **High Leverage Point**: point with \"potential\" to impact regression line because $X$-value is unusual\n\n## High Leverage, Low Influence\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](13-slr-outliers_files/figure-html/unnamed-chunk-6-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n\n## High Leverage, High Influence\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](13-slr-outliers_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n\n## Low Leverage, Low Influence\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](13-slr-outliers_files/figure-html/unnamed-chunk-8-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n\n\n## Low Leverage, High Influence\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](13-slr-outliers_files/figure-html/unnamed-chunk-9-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n\n## Low Leverage, High Influence\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](13-slr-outliers_files/figure-html/unnamed-chunk-10-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n\n# Application exercise\n\n::: appex\nðŸ“‹ [AE-09: Outliers](https://mat212fa24.netlify.app/ae/ae-09-outliers)\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}