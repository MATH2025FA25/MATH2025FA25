{
  "hash": "aae8d2068f9b8992602e3158fd4c569b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Model comparison\"\nauthor: \"Prof. Eric Friedlander\"\ndate: \"2024-10-23\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[ðŸ”— MAT 212 - Fall 2024 -  Schedule](https://mat212fa24.netlify.app/schedule)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    multiplex: false\n    transition: fade\n    slide-number: false\n    incremental: false \n    chalkboard: true\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\nexecute:\n  freeze: auto\n  echo: true\n  cache: false\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\nbibliography: references.bib\n---\n\n\n\n\n\n\n## Announcements\n\n-   Project: EDA Due Wednesday, October 30th\n-   Oral R Quiz (time to start scheduling it)\n\n::: appex\nðŸ“‹ [AE 14 - Model Comparison](https://mat212fa24.netlify.app/ae/ae-14-comparison)\n\n- Open up AE 14 and complete Exercises 0-2\n:::\n\n\n## Topics\n\n::: nonincremental\n-   ANOVA for multiple linear regression and sum of squares\n-   Comparing models with $R^2$ \n:::\n\n\n## Computational setup\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# load packages\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(yardstick)\nlibrary(ggformula)\nlibrary(supernova)\nlibrary(tidymodels)\nlibrary(patchwork)\nlibrary(knitr)\nlibrary(janitor)\nlibrary(kableExtra)\n\n# set default theme and larger font size for ggplot2\nggplot2::theme_set(ggplot2::theme_bw(base_size = 20))\n```\n:::\n\n\n\n\n# Introduction\n\n## Data: Restaurant tips\n\nWhich variables help us predict the amount customers tip at a restaurant?\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 169 Ã— 4\n     Tip Party Meal   Age   \n   <dbl> <dbl> <chr>  <chr> \n 1  2.99     1 Dinner Yadult\n 2  2        1 Dinner Yadult\n 3  5        1 Dinner SenCit\n 4  4        3 Dinner Middle\n 5 10.3      2 Dinner SenCit\n 6  4.85     2 Dinner Middle\n 7  5        4 Dinner Yadult\n 8  4        3 Dinner Middle\n 9  5        2 Dinner Middle\n10  1.58     1 Dinner SenCit\n# â„¹ 159 more rows\n```\n\n\n:::\n:::\n\n\n\n\n## Variables\n\n**Predictors**:\n\n::: nonincremental\n-   `Party`: Number of people in the party\n-   `Meal`: Time of day (`Lunch`, `Dinner`, `Late Night`)\n-   `Age`: Age category of person paying the bill (`Yadult`, `Middle`, `SenCit`)\n:::\n\n**Outcome**: `Tip`: Amount of tip\n\n## Outcome: `Tip`\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](20-comparison_files/figure-revealjs/unnamed-chunk-5-1.png){fig-align='center' width=3000}\n:::\n:::\n\n\n\n\n## Predictors\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](20-comparison_files/figure-revealjs/unnamed-chunk-6-1.png){fig-align='center' width=3000}\n:::\n:::\n\n\n\n\n## Relevel categorical predictors\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntips <- tips |>\n  mutate(\n    Meal = fct_relevel(Meal, \"Lunch\", \"Dinner\", \"Late Night\"),\n    Age  = fct_relevel(Age, \"Yadult\", \"Middle\", \"SenCit\")\n  )\n```\n:::\n\n\n\n\n## Predictors, again\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](20-comparison_files/figure-revealjs/unnamed-chunk-8-1.png){fig-align='center' width=3000}\n:::\n:::\n\n\n\n\n## Outcome vs. predictors\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](20-comparison_files/figure-revealjs/unnamed-chunk-9-1.png){fig-align='center' width=3600}\n:::\n:::\n\n\n\n\n## Fit and summarize model {.midi}\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) |   -0.170|     0.366|    -0.465|   0.643|\n|Party       |    1.837|     0.124|    14.758|   0.000|\n|AgeMiddle   |    1.009|     0.408|     2.475|   0.014|\n|AgeSenCit   |    1.388|     0.485|     2.862|   0.005|\n\n\n:::\n:::\n\n\n\n\n. . .\n\n<br>\n\n::: question\nIs this model good?\n:::\n\n## Another model summary\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nanova(tip_fit) |>\n  tidy() |>\n  kable(digits = 2)\n```\n\n::: {.cell-output-display}\n\n\n|term      |  df|   sumsq|  meansq| statistic| p.value|\n|:---------|---:|-------:|-------:|---------:|-------:|\n|Party     |   1| 1188.64| 1188.64|    285.71|    0.00|\n|Age       |   2|   38.03|   19.01|      4.57|    0.01|\n|Residuals | 165|  686.44|    4.16|        NA|      NA|\n\n\n:::\n:::\n\n\n\n\n# Analysis of variance (ANOVA)\n\n## Analysis of variance (ANOVA)\n\n<br>\n\n![](images/13/model-anova.png){fig-align=\"center\"}\n\n## ANOVA {.smaller}\n\n-   **Main Idea:** Decompose the total variation of the outcome into:\n    -   the variation that can be explained by the each of the variables in the model\n    -   the variation that **can't** be explained by the model (left in the residuals)\n-   $SS_{Total}$: Total sum of squares, variability of outcome, $\\sum_{i = 1}^n (y_i - \\bar{y})^2$\n-   $SS_{Error}$: Residual sum of squares, variability of residuals, $\\sum_{i = 1}^n (y_i - \\hat{y}_i)^2$\n-   $SS_{Model} = SS_{Total} - SS_{Error}$: Variability explained by the model, $\\sum_{i = 1}^n (\\hat{y}_i - \\bar{y})^2$\n\n . . .\n \n Complete Exercise 3.\n\n## ANOVA output in R[^1]\n\n[^1]: [Click here](anova-table.html) for explanation about the way R calculates sum of squares for each variable.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n\n|term      |  df|      sumsq|      meansq|  statistic|  p.value|\n|:---------|---:|----------:|-----------:|----------:|--------:|\n|Party     |   1| 1188.63588| 1188.635880| 285.711511| 0.000000|\n|Age       |   2|   38.02783|   19.013916|   4.570361| 0.011699|\n|Residuals | 165|  686.44389|    4.160266|         NA|       NA|\n\n\n:::\n:::\n\n\n\n\n## ANOVA output, with totals\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n\n|term      |  df|   sumsq|meansq  |statistic |p.value |\n|:---------|---:|-------:|:-------|:---------|:-------|\n|Party     |   1| 1188.64|1188.64 |285.71    |0       |\n|Age       |   2|   38.03|19.01   |4.57      |0.01    |\n|Residuals | 165|  686.44|4.16    |          |        |\n|Total     | 168| 1913.11|        |          |        |\n\n\n:::\n:::\n\n\n\n\n## Sum of squares {.smaller}\n\n::: columns\n::: {.column width=\"50%\"}\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> df </th>\n   <th style=\"text-align:right;\"> sumsq </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Party </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 1188.64 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Age </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 38.03 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Residuals </td>\n   <td style=\"text-align:right;\"> 165 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 686.44 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Total </td>\n   <td style=\"text-align:right;\"> 168 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 1913.11 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n:::\n\n::: {.column width=\"50%\"}\n-   $SS_{Total}$: Total sum of squares, variability of outcome, $\\sum_{i = 1}^n (y_i - \\bar{y})^2$\n-   $SS_{Error}$: Residual sum of squares, variability of residuals, $\\sum_{i = 1}^n (y_i - \\hat{y}_i)^2$\n-   $SS_{Model} = SS_{Total} - SS_{Error}$: Variability explained by the model, $\\sum_{i = 1}^n (\\hat{y}_i - \\bar{y})^2$\n:::\n:::\n\n\n## Sum of squares: $SS_{Total}$\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> df </th>\n   <th style=\"text-align:right;\"> sumsq </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Party </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1188.64 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Age </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 38.03 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Residuals </td>\n   <td style=\"text-align:right;\"> 165 </td>\n   <td style=\"text-align:right;\"> 686.44 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(217, 227, 228, 255) !important;\"> Total </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 168 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 1913.11 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n<br>\n\n<center>\n\n$SS_{Total}$: Total sum of squares, variability of outcome\n\n<br>\n\n$\\sum_{i = 1}^n (y_i - \\bar{y})^2$ = 1913.11\n\n</center>\n\n## Sum of squares: $SS_{Error}$\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> df </th>\n   <th style=\"text-align:right;\"> sumsq </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Party </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1188.64 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Age </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 38.03 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(217, 227, 228, 255) !important;\"> Residuals </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 165 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 686.44 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Total </td>\n   <td style=\"text-align:right;\"> 168 </td>\n   <td style=\"text-align:right;\"> 1913.11 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n<br>\n\n<center>\n\n$SS_{Error}$: Residual sum of squares, variability of residuals\n\n<br>\n\n$\\sum_{i = 1}^n (y_i - \\hat{y}_i)^2$ = 686.44\n\n</center>\n\n## Sum of squares: $SS_{Model}$\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> df </th>\n   <th style=\"text-align:right;\"> sumsq </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(217, 227, 228, 255) !important;\"> Party </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 1 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 1188.64 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: rgba(217, 227, 228, 255) !important;\"> Age </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 2 </td>\n   <td style=\"text-align:right;background-color: rgba(217, 227, 228, 255) !important;\"> 38.03 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Residuals </td>\n   <td style=\"text-align:right;\"> 165 </td>\n   <td style=\"text-align:right;\"> 686.44 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Total </td>\n   <td style=\"text-align:right;\"> 168 </td>\n   <td style=\"text-align:right;\"> 1913.11 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n<br>\n\n<center>\n\n$SS_{Model}$: Variability explained by the model\n\n<br>\n\n$\\sum_{i = 1}^n (\\hat{y}_i - \\bar{y})^2 = SS_{Model} = SS_{Total} - SS_{Error} =$ 1226.67\n\n</center>\n\n## F-Test: Testing the whole model at once {.smaller}\n\n**Hypotheses:** \n\n$H_0: \\beta_1 = \\beta_2 = \\cdots = \\beta_k = 0$ vs. $H_A:$ at least one $\\beta_i \\neq 0$ \n\n. . .\n\n**Test statistic:** F-statistics\n\n$$\nF = \\frac{MSModel}{MSE} = \\frac{SSModel/k}{SSE/(n-k-1)} \\\\\n$$\n\n. . .\n\n**p-value:** Probability of observing a test statistic at least as extreme (in the direction of the alternative hypothesis) from the null value as the one observed\n\n$$\n\\text{p-value} = P(F > \\text{test statistic}),\n$$\n\ncalculated from an $F$ distribution with $k$ and $n - k - 1$ degrees of freedom.\n\n## F-test in R\n\n- Use `glance` function from `broom` package\n  - `statistic`: F-statistic\n  - `p.value`: p-value from F-test\n\n## R-squared, $R^2$\n\n**Recall**: $R^2$ is the proportion of the variation in the response variable explained by the regression model.\n\n. . .\n\n$$\nR^2 = \\frac{SS_{Model}}{SS_{Total}} = 1 - \\frac{SS_{Error}}{SS_{Total}}\n$$\n\nComplete Exercises 4-7.\n\n## Recap\n\n-   ANOVA for multiple linear regression and sum of squares\n-   $R^2$ for multiple linear regression\n",
    "supporting": [
      "20-comparison_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}